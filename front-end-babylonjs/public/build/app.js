!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var o=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n(this,e),this.currentID=0,this.logs=[],this.enabled=t}var t,i,o;return t=e,(i=[{key:"push",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enabled&&(e.ID=++this.currentID,this.logs.push(e))}},{key:"doing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.push({doing:e})}},{key:"getLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.logs.slice(-e)}},{key:"logLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log(this.getLast(e))}},{key:"get",value:function(){return this.logs}},{key:"log",value:function(){console.log(this.logs)}},{key:"debug",value:function(e){GAME.options.debugMode&&console.log("DEBUG LOG: "+e)}},{key:"debugWarning",value:function(e){GAME.options.debugMode&&console.warn("DEBUG LOG: "+e)}},{key:"debugError",value:function(e){GAME.options.debugMode&&console.error("DEBUG LOG: "+e)}}])&&s(t.prototype,i),o&&s(t,o),e}();function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentControlID=0,this.controls=[],this.menuTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(t)}var t,i,n;return t=e,(i=[{key:"addButton",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new BABYLON.GUI.Button.CreateSimpleButton(e,t);return n.width=i.width||.5,n.height=i.height||"60px",n.color=i.color||"black",n.outlineWidth=i.outlineWidth||0,n.outlineColor=i.outlineColor||n.color,n.background=i.background||"white",n.left=i.left||"0px",n.top=i.top||"0px",n.textHorizontalAlignment=void 0!==i.horizontalAlignment?i.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,n.textVerticalAlignment=void 0!==i.verticalAlignment?i.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,i.onclick&&n.onPointerUpObservable.add(i.onclick),this.menuTexture.addControl(n),this.add(n),n}},{key:"addImgButton",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new BABYLON.GUI.Button.CreateImageOnlyButton(e,"assets/scenes/scam-man-play-btn.png");return i.width="0.2",i.height="0.1",i.thickness=0,i.top="210",t.onclick&&i.onPointerUpObservable.add(t.onclick),this.menuTexture.addControl(i),this.add(i),i}},{key:"addText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new BABYLON.GUI.TextBlock;return i.text=e,i.color=t.color||"white",i.fontSize=t.fontSize||28,i.outlineWidth=t.outlineWidth||0,i.outlineColor=t.outlineColor||"black",i.lineSpacing=t.lineSpacing||"5px",i.left=t.left||"0px",i.top=t.top||"0px",i.textHorizontalAlignment=void 0!==t.horizontalAlignment?t.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,i.textVerticalAlignment=void 0!==t.verticalAlignment?t.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,i.textWrapping=t.wrapping||!0,this.menuTexture.addControl(i),this.add(i),i}},{key:"addImage",value:function(){var e=new BABYLON.GUI.Image("img","assets/scenes/scam-man-fulltitle-mainpage.png");return e.strech=BABYLON.GUI.Image.stretch_uniform,e.width="0.7",e.height="0.6",e.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,e.top="100",this.menuTexture.addControl(e),e}},{key:"add",value:function(e){e.uiControlID=this.currentControlID++,this.controls.push(e)}},{key:"remove",value:function(e){e.isVisible=!1,this.controls.splice(e.uiControlID,1)}},{key:"show",value:function(){this.controls.forEach((function(e){return e.isVisible=!0}))}},{key:"hide",value:function(){this.controls.forEach((function(e){return e.isVisible=!1}))}}])&&r(t.prototype,i),n&&r(t,n),e}();function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.statuses={RUNNING:!0,JUMPING:!1,DRAGGING:!1,FALLING_DOWN:!1,SLOW:!1,DEAD:!1},this.coinsTextControl=null,this.metersTextControl=null,this.livesTextControl=null,this.dieSound=null,this.jumpSound=null,this.damageSound=null,this.gotCoinSound=null,this.godMode=!1,this.defaultSpeed=GAME.options.player.defaultSpeed,this.speed=this.defaultSpeed,this.gravity=GAME.options.player.gravity,this.jumpForce=GAME.options.player.jumpForce,this.jumpMaxAltitude=GAME.options.player.jumpMaxAltitude,this.defaultAltitude=.25,this.lastAltitude=this.defaultAltitude,this.coins=0,this.points=0,this.pointsRecord=!1,this.damages=0,this.onDie=null,this.changePosition=!0,this.nextBullet=!0,this.lives=GAME.options.player.lives,this.travelledDistance=0,this.totalTravelledDistance=0,this.setupPlayer()}var t,i,n;return t=e,(i=[{key:"setupPlayer",value:function(){var e=this;this.dieSound=this.level.assets.getSound("playerDieSound"),this.gotCoinSound=this.level.assets.getSound("gotCoinSound"),this.damageSound=this.level.assets.getSound("damageSound");var t=new BABYLON.DirectionalLight("dir01",new BABYLON.Vector3(0,-.5,-1),this.scene);new BABYLON.ShadowGenerator(524,t).useBlurExponentialShadowMap=!0;var i=this.scene;BABYLON.SceneLoader.ImportMesh("him","assets/scenes/","Dude.babylon",i,(function(e,t,n){var s=e[0];s.rotation.x=-.5,s.rotation.y=3.2,s.position=new BABYLON.Vector3(0,-12,10),s.scaling=new BABYLON.Vector3(.05,.05,.05);var o=new BABYLON.Texture("/assets/scenes/scam-man-onduty.png",i);return s.diffuseTexture=o,i.beginAnimation(n[0],0,100,!0,1),i}),(function(e){console.log("InProgress")}),(function(e,t,i){console.log("onError")})),this.mesh=BABYLON.MeshBuilder.CreateBox("player",{width:.3333333,height:.5,depth:.3333333},this.scene);var n=!1;this.mesh.position.y=this.defaultAltitude,setInterval((function(){n||e.scene.meshes.forEach((function(t){"him"==t.name&&(e.mesh.visibility=!1,n=!0,e.mesh2=t)}))}),500),this.mesh.setEllipsoidPerBoundingBox(),this.setupAnimations(),this.createHUD()}},{key:"setupAnimations",value:function(){var e=new BABYLON.Animation("blinkAnimation","material.alpha",120,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),t=[];t.push({frame:0,value:1}),t.push({frame:15,value:.2}),t.push({frame:30,value:1}),e.setKeys(t),this.mesh.animations=[],this.mesh.animations.push(e),this.mesh2&&(this.mesh2.animations=[],this.mesh2.animations.push(e))}},{key:"createHUD",value:function(){this.hud=new a("playerHudUI"),this.metersTextControl=this.hud.addText("Age: 0",{top:"10px",left:"10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT}),this.coinsTextControl=this.hud.addText("Pension Pot: $0",{top:"10px",left:"-10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT}),this.livesTextControl=this.hud.addText("Lives: "+this.lives,{top:"35px",left:"-10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT})}},{key:"getMesh",value:function(){return this.mesh}},{key:"getMesh2",value:function(){return this.mesh2?this.mesh2:this.mesh}},{key:"damage",value:function(){var e=this;this.damages++,this.damageSound.play(),this.blink(),this.speed=this.defaultSpeed/2,this.statuses.SLOW=!0,setTimeout((function(){e.statuses.SLOW=!1,e.speed=e.defaultSpeed}),1500)}},{key:"blink",value:function(){var e=this,t=this.scene.beginAnimation(this.mesh,0,30,!0);setTimeout((function(){t.pause(),e.mesh.material.alpha=1,e.mesh2.material.alpha=1}),1500)}},{key:"move",value:function(){if(!this.statuses.DEAD){var e=this.scene.getAnimationRatio()/50,t=this.statuses.JUMPING&&!this.statuses.FALLING_DOWN?this.jumpForce*e:0,i=this.speed*e;i*=this.statuses.JUMPING?1.5:1,this.mesh.moveWithCollisions(new BABYLON.Vector3(0,0+t,i)),this.mesh2&&this.mesh2.moveWithCollisions(new BABYLON.Vector3(0,0+t-12,i)),this.checkPlayerLateralMovement(e),this.calculateTravelledDistance(e),this.checkPlayerAltitude(),this.checkPlayerDragging(),this.shoot(),this.mesh.position.y<=-2&&!this.statuses.DEAD&&this.die()}}},{key:"calculateTravelledDistance",value:function(e){this.travelledDistance>=100&&(this.travelledDistance=0),this.travelledDistance+=this.speed*e/100,this.totalTravelledDistance+=this.speed*e,this.metersTextControl.text="Age: "+Math.floor(this.totalTravelledDistance)}},{key:"checkPlayerAltitude",value:function(){this.mesh.position.y<this.lastAltitude?this.statuses.FALLING_DOWN=!0:this.statuses.FALLING_DOWN=!1,this.lastAltitude=this.mesh.position.y}},{key:"checkPlayerLateralMovement",value:function(e){var t=this;!GAME.keys.left||this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.x-=this.speed/5*e,this.changePosition&&(this.changePosition=!1,this.mesh2.position.x=this.mesh2.position.x<=-6?-6:this.mesh2.position.x-6,setTimeout((function(){t.changePosition=!0}),200))),!GAME.keys.right||this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.x+=this.speed/5*e,this.changePosition&&(this.changePosition=!1,this.mesh2.position.x=this.mesh2.position.x>=6?6:this.mesh2.position.x+6,setTimeout((function(){t.changePosition=!0}),200)))}},{key:"checkPlayerDragging",value:function(){var e=this;GAME.keys.down?this.statuses.DRAGGING||(this.statuses.DRAGGING=!0,this.speed=1.5*this.defaultSpeed,this.level.interpolate(this.mesh.scaling,"y",.5,100,(function(){e.mesh.ellipsoid.y=.125})),setTimeout((function(){e.statuses.DRAGGING=!1,e.mesh.ellipsoid.y=.25,e.level.interpolate(e.mesh.scaling,"y",1,100)}),700)):this.statuses.DRAGGING||(this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.y=this.defaultAltitude,this.mesh2&&(this.mesh2.position.y=this.defaultAltitude-12)),this.statuses.SLOW||(this.speed=this.defaultSpeed))}},{key:"getTravelledDistance",value:function(){return this.travelledDistance}},{key:"keepCoin",value:function(){this.coins++,this.coinsTextControl.text="Pension Pot: $"+this.coins,this.gotCoinSound.play()}},{key:"shoot",value:function(){var e=this;if(this.mesh2){var t=(new Date).getTime();if((new Date).getTime(),GAME.keys.shoot&&this.nextBullet){this.nextBullet=!1;var i=new BABYLON.Vector3(0,.2,0),n=this.mesh2.getDirection(i);n.normalize();var s=BABYLON.Mesh.CreateSphere("".concat(t,"bullet"),16,1,this.scene);if((new Date).getTime(),s.position=this.mesh2.getAbsolutePosition().clone(),this.scene&&this.scene.actionManager){var o=this.scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnEveryFrameTrigger,(function(e){s.position.addInPlace(n)})));setTimeout((function(){e.scene.actionManager.unregisterAction(o),s.dispose(),e.nextBullet=!0}),500),setInterval((function(){e.scene.meshes.forEach((function(t){t.name.includes("scam_fall_")&&s.intersectsMesh(t,!0)&&(e.keepCoin(),e.slicer(t))}))}),10)}else{this.scene.actionManager=new BABYLON.ActionManager(this.scene);var r=this.scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnEveryFrameTrigger,(function(e){s.position.addInPlace(n)})));setTimeout((function(){e.scene.actionManager.unregisterAction(r),s.dispose(),e.nextBullet=!0}),500)}}}}},{key:"reset",value:function(){this.statuses.DEAD=!1,this.statuses.JUMPING=!1,this.statuses.FALLING_DOWN=!1,this.statuses.DRAGGING=!1,this.coins=0,this.damages=0,this.mesh.position.x=0,this.mesh.position.y=this.defaultAltitude,this.mesh.position.z=0,this.mesh2.position.x=0,this.mesh2.position.y=this.defaultAltitude-12,this.mesh2.position.z=0,this.travelledDistance=0,this.totalTravelledDistance=0,this.lives=GAME.options.player.lives}},{key:"die",value:function(){this.godMode||(this.lives<=1?(this.lives--,this.livesTextControl.text="Lives: "+this.lives,this.statuses.DEAD=!0,this.dieSound.play(),this.onDie&&this.onDie()):(this.lives--,this.livesTextControl.text="Lives: "+this.lives))}},{key:"getPoints",value:function(){return this.points}},{key:"calculatePoints",value:function(){return this.points=0,this.points+=10*this.coins,this.points+=this.totalTravelledDistance,this.points-=5*this.damages,this.points=this.points>0?this.points.toFixed(0):0,this.checkAndSaveRecord(this.points),this.points}},{key:"checkAndSaveRecord",value:function(e){var t=0;this.pointsRecord=!1,window.localStorage.last_record&&(t=parseInt(window.localStorage.last_record,10)),t<e&&(this.pointsRecord=!0,window.localStorage.last_record=e)}},{key:"hasMadePointsRecord",value:function(){return this.pointsRecord}},{key:"getLastRecord",value:function(){return window.localStorage.last_record||0}},{key:"slicer",value:function(e){if(e&&e.subMeshes){var t=new BABYLON.Vector3.Zero,i=BABYLON.Mesh.CreateBox("boxSlicer",100,this.scene);i.rotation=new BABYLON.Vector3(.46,0,0),i.position=new BABYLON.Vector3(50+t.x,t.y,50+t.z);var n=BABYLON.CSG.FromMesh(e),s=BABYLON.CSG.FromMesh(i),o=n.subtract(s).toMesh(e.name+"_slice_left");o.physicsImpostor=new BABYLON.PhysicsImpostor(o,BABYLON.PhysicsImpostor.BoxImpostor,{mass:10,restitution:.5},this.scene);var r=n.intersect(s).toMesh(e.name+"_slice_right");r.physicsImpostor=new BABYLON.PhysicsImpostor(r,BABYLON.PhysicsImpostor.BoxImpostor,{mass:10,restitution:.5},this.scene),e.dispose(),i.dispose()}}}])&&l(t.prototype,i),n&&l(t,n),e}();function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.meshes=[],this.sounds=[],this.manager=new BABYLON.AssetsManager(this.scene),this.manager.onFinish=function(e){i&&i(e)}}var t,i,n;return t=e,(i=[{key:"addSound",value:function(e,t,i){var n=this;return this.manager.addBinaryFileTask(e+"__SoundTask",t).onSuccess=function(t){n.sounds[e]=new BABYLON.Sound(e,t.data,n.scene,null,i),i.onSuccess&&i.onSuccess(n.sounds[e])},this.sounds[e]}},{key:"addMusic",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.loop=void 0===i.loop||i.loop,i.volume=void 0!==i.volume?i.volume:.5,i.autoplay=void 0===i.autoplay||i.autoplay,this.addSound(e,t,i)}},{key:"addMesh",value:function(){}},{key:"getMesh",value:function(e){return this.meshes[e]}},{key:"getSound",value:function(e){return this.sounds[e]}},{key:"load",value:function(){this.manager.load()}}])&&h(t.prototype,i),n&&h(t,n),e}();function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.materials={},this.scene=null,this.assets=null}var t,i,n;return t=e,(i=[{key:"start",value:function(){GAME.resume(),GAME.stopRenderLoop(),this.setProperties?this.setProperties():GAME.log.debugWarning("The setProperties method is recommended to initialize the Level properties"),this.createScene()}},{key:"createScene",value:function(){var e=this;return this.scene=new BABYLON.Scene(GAME.engine),new BABYLON.Layer("back","/assets/scenes/scam-man-bg.png",this.scene).isBackground=!0,this.assets=new c(this.scene,(function(){GAME.log.debug("Level Assets loaded"),e.buildScene?e.buildScene():GAME.log.debugWarning("You can add the buildScene method to your level to define your scene"),e.beforeRender?e.scene.registerBeforeRender(e.beforeRender.bind(e)):GAME.log.debugWarning("You can define animations and other game logics that happends inside the main loop on the beforeRender method"),GAME.startRenderLoop()})),this.setupAssets&&this.setupAssets(),this.assets.load(),this.scene}},{key:"exit",value:function(){this.scene.dispose(),this.scene=null}},{key:"addCollider",value:function(e,t){var i=BABYLON.MeshBuilder.CreateBox(e,{width:t.width||1,height:t.height||1,depth:t.depth||1},this.scene);if(BABYLON.Tags.AddTagsTo(i,"collider boxCollider"),i.position.x=t.positionX||0,i.position.y=t.positionY||0,i.position.z=t.positionZ||0,i.isVisible=!!t.visible&&t.visible,i.isVisible){var n=new BABYLON.StandardMaterial(e+"Material");n.diffuseColor=new BABYLON.Color3(.5,.5,0),n.alpha=.5,i.material=n}return t.timeToDispose=t.timeToDispose?t.timeToDispose:0,i.actionManager=new BABYLON.ActionManager(this.scene),i.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnIntersectionEnterTrigger,parameter:t.collisionMesh},(function(){t.onCollide&&t.onCollide(),t.disposeAfterCollision&&setTimeout((function(){i.dispose()}),t.timeToDispose)}))),i}},{key:"disposeColliders",value:function(){for(var e=this.scene.getMeshesByTags("collider"),t=0;t<e.length;t++)e[t].dispose()}},{key:"addMaterial",value:function(e){this.materials[e.name]=e}},{key:"getMaterial",value:function(e){return this.materials[e]}},{key:"removeMaterial",value:function(e){var t=null;(t=this.materials[e])&&(t.dispose(),delete this.materials[e])}},{key:"interpolate",value:function(e,t,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.scene.actionManager||(this.scene.actionManager=new BABYLON.ActionManager(this.scene));var o=new BABYLON.InterpolateValueAction(BABYLON.ActionManager.NothingTrigger,e,t,i,n);o.onInterpolationDoneObservable.add((function(){GAME.log.debug("Interpolation done"),s&&s()})),this.scene.actionManager.registerAction(o),o.execute()}}])&&d(t.prototype,i),n&&d(t,n),e}();function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.player=t.player,this.tileDepth=5,this.maxTilesAtTime=1,this.lastTileType="HOLE",this.generatedTilesNumber=0,this.generatedTilesBlocksNumber=0,this.startedCoin=!1,this.scene.enablePhysics(new BABYLON.Vector3(0,-5,0)),this.createCommonMaterials()}var t,i,n;return t=e,(i=[{key:"createCommonMaterials",value:function(){var e=new BABYLON.StandardMaterial("coinMaterial",this.scene);e.diffuseTexture=new BABYLON.Texture("assets/scenes/coin_euro.png",this.scene),e.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.coinColor),e.emissiveColor=new BABYLON.Color3.FromHexString(GAME.options.coinColor);var t=new BABYLON.StandardMaterial("tileMaterialLight",this.scene);t.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.tileLightColor),t.alpha=0;var i=new BABYLON.StandardMaterial("tileMaterialDark",this.scene);i.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.tileDarkColor),i.alpha=0;var n=new BABYLON.StandardMaterial("hazardMaterial",this.scene);n.diffuseTexture=new BABYLON.Texture("assets/scenes/coin_euro.png",this.scene),n.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.hazardColor),e.freeze(),t.freeze(),i.freeze(),n.freeze(),this.level.addMaterial(e),this.level.addMaterial(t),this.level.addMaterial(i),this.level.addMaterial(n)}},{key:"generate",value:function(){var e=this;this.startedCoin||this.createNormalGroundTile(),this.generatedTilesBlocksNumber+=1;for(var t=1;t<=this.maxTilesAtTime;t++){this.generatedTilesNumber+=1;var i={width:100,height:100,visible:!1,disposeAfterCollision:!0,collisionMesh:this.player.getMesh(),positionZ:(this.generatedTilesNumber-1)*this.tileDepth};if(1==t&&1!=this.generatedTilesNumber){var n=Object.assign({},i);n.onCollide=function(){e.disposeOldTiles()},this.level.addCollider("deleteOldTilesCollider",n)}if(1==t){var s=Object.assign({},i);s.onCollide=function(){e.generate()},this.level.addCollider("generateMoreTilesCollider",s)}this.createTiles()}}},{key:"createTiles",value:function(){this.generatedTilesNumber>3&&this.createTileWithHighObstacleTile()}},{key:"createTile",value:function(e){e=e||{width:GAME.options.level.tileWidth,height:.1,depth:this.tileDepth};var t=BABYLON.MeshBuilder.CreateBox("groundTile"+this.generatedTilesNumber,e,this.scene);return BABYLON.Tags.AddTagsTo(t,"tilesBlock tilesBlock"+this.generatedTilesBlocksNumber),t.receiveShadows=!0,t.position.z=(this.generatedTilesNumber-1)*this.tileDepth,t.position.y=-.5,t.checkCollisions=!0,t.material=this.generatedTilesNumber%2==0?this.level.getMaterial("tileMaterialLight"):this.level.getMaterial("tileMaterialDark"),t}},{key:"createCoins",value:function(e){var t=this;this.startedCoin=!0,setInterval((function(){if(!GAME.isPaused()){var i=e.position.x,n=0,s=t.player.getMesh(),o=Math.floor(100*Math.random());o>=0&&o<33.33&&(i=-4,n=-1),o>=33.33&&(i=e.position.x),o>=66.66&&(i=4.2,n=1);var r=t.generatedTilesNumber,a=BABYLON.Mesh.CreateCylinder("coin_fall_"+Math.random()+r+t.generatedTilesNumber,.25,.8,.8,16,0,t.scene);a.physicsImpostor=new BABYLON.PhysicsImpostor(a,BABYLON.PhysicsImpostor.SphereImpostor,{mass:300},t.scene),a.material=t.level.getMaterial("coinMaterial"),a.position.x=i,a.position.y=6,a.position.z=s.position.z+25,a.rotation.x=2,BABYLON.Tags.AddTagsTo(a,"tilesBlock_fall tilesBlock"+t.generatedTilesBlocksNumber),a.physicsImpostor.setLinearVelocity({isNonUniform:!0,x:n,y:.001,z:0}),a.executeOnIntersection(s,(function(){t.player.keepCoin(),a.material.alpha=0,t.level.interpolate(a.position,"y",1e3,10)}),!0),setTimeout((function(){a.dispose()}),2e4)}}),300)}},{key:"createNormalGroundTile",value:function(){var e=this.createTile();Math.floor(100*Math.random())>40&&this.createCoins(e,!0)}},{key:"createTileWithHighObstacleTile",value:function(e){var t=this,i=this.createTile(e).position.x,n=this.player.getMesh(),s=this.player.getMesh2(),o=(Math.floor(100*Math.random()),BABYLON.Mesh.CreateCylinder("scam_fall_"+Math.random()+1+this.generatedTilesNumber,.25,.8,.8,16,0,this.scene));o.physicsImpostor=new BABYLON.PhysicsImpostor(o,BABYLON.PhysicsImpostor.SphereImpostor,{mass:300},this.scene),o.material=this.level.getMaterial("hazardMaterial"),o.position.x=i,o.position.y=5,o.position.z=n.position.z+20,o.rotation.x=2,BABYLON.Tags.AddTagsTo(o,"tilesBlock_fall tilesBlock"+this.generatedTilesBlocksNumber),o.physicsImpostor.setLinearVelocity({isNonUniform:!0,x:0,y:.001,z:0});var r=!1;setInterval((function(){r||o.position.y<s.position.y&&(o.dispose(),t.player.die(),r=!0)}),100),setTimeout((function(){o.dispose()}),2e4)}},{key:"disposeOldTiles",value:function(){for(var e=this.generatedTilesBlocksNumber-1,t=this.scene.getMeshesByTags("tilesBlock"+e),i=0;i<t.length;i++)t[i].dispose()}},{key:"disposeAll",value:function(){for(var e=this.scene.getMeshesByTags("tilesBlock"),t=0;t<e.length;t++)e[t].dispose()}},{key:"reset",value:function(){this.disposeAll(),this.lastTileType="HOLE",this.generatedTilesNumber=0}}])&&f(t.prototype,i),n&&f(t,n),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k=function(e){function t(){return y(this,t),A(this,B(t).apply(this,arguments))}var i,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,e),i=t,(n=[{key:"setProperties",value:function(){this.player=null,this.tiles=null,this.menu=null,this.pointsTextControl=null,this.currentRecordTextControl=null,this.hasMadeRecordTextControl=null}},{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/Guitar-Mayhem.mp3"),this.assets.addSound("playerDieSound","/assets/sounds/game-die.mp3",{volume:.4}),this.assets.addSound("gotCoinSound","/assets/sounds/coin-c-09.wav"),this.assets.addSound("damageSound","/assets/sounds/damage.wav"),this.assets.addSound("approachSound","/assets/sounds/monster.wav"),this.assets.addSound("attackSound","/assets/sounds/monster_attack.mp3")}},{key:"buildScene",value:function(){this.scene.clearColor=new BABYLON.Color3.FromHexString(GAME.options.backgroundColor),this.createMenus();var e=this.createArcCamera();this.scene.activeCamera=e;var t=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,10,0),this.scene),i=new BABYLON.PointLight("light2",new BABYLON.Vector3(0,100,-100),this.scene);t.intensity=.9,i.intensity=.2,this.createPlayer(),this.tiles=new v(this),this.tiles.generate(),this.scene.debugLayer.hide(),this.scene.debugLayer.show()}},{key:"createMenus",value:function(){var e=this;this.menu=new a("runnerMenuUI"),this.pointsTextControl=this.menu.addText("Points: 0",{top:"-150px",color:GAME.options.pointsTextColor,outlineColor:GAME.options.pointsOutlineTextColor,outlineWidth:"2px",fontSize:"40px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.currentRecordTextControl=this.menu.addText("Current Record: 0",{top:"-100px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.hasMadeRecordTextControl=this.menu.addText("You got a new Points Record!",{top:"-60px",color:GAME.options.recordTextColor,fontSize:"20px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.menu.addButton("replayButton","Replay Game",{onclick:function(){return e.replay()}}),this.menu.addButton("backButton","Return to Home",{top:"70px",onclick:function(){return GAME.goToLevel("HomeMenuLevel")}}),this.menu.hide(),this.createTutorialText()}},{key:"createTutorialText",value:function(){var e=this,t=GAME.isMobile()?"Swipe the screen to control Scam Man":"Use Arrow Keys or WASD to Move & Space to Shoot.",i=this.menu.addText(t,{verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER});setTimeout((function(){e.menu.remove(i)}),5e3)}},{key:"createArcCamera",value:function(){var e=new BABYLON.ArcRotateCamera("arcCamera",0,300,8,BABYLON.Vector3.Zero(),this.scene);return e.ctype=1,e.setPosition(new BABYLON.Vector3(0,1,-3)),e.radius=5,e}},{key:"createPlayer",value:function(){var e=this;this.player=new u(this),this.scene.activeCamera.lockedTarget=this.player.getMesh();var t=new BABYLON.DirectionalLight("playerLight",new BABYLON.Vector3(1,-2,1),this.scene);t.intensity=.3,t.parent=this.player.mesh,this.scene.shadowGenerator=new BABYLON.ShadowGenerator(32,t),this.scene.shadowGenerator.useBlurExponentialShadowMap=!0,this.scene.shadowGenerator.getShadowMap().renderList.push(this.player.mesh),this.player.onDie=function(){GAME.pause(),e.player.calculatePoints(),e.showMenu()}}},{key:"showMenu",value:function(){this.pointsTextControl.text="Points: "+this.player.getPoints(),this.currentRecordTextControl.text="Current Record: "+this.player.getLastRecord(),this.menu.show(),this.player.hasMadePointsRecord()?this.hasMadeRecordTextControl.isVisible=!0:this.hasMadeRecordTextControl.isVisible=!1}},{key:"beforeRender",value:function(){var e=this;GAME.isPaused()||setTimeout((function(){e.player.move()}),3e3)}},{key:"replay",value:function(){this.tiles.reset(),this.disposeColliders(),this.player.reset(),this.tiles.generate(),this.menu.hide(),GAME.resume()}}])&&g(i.prototype,n),s&&g(i,s),t}(p);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=function(e){function t(){return N(this,t),b(this,M(t).apply(this,arguments))}var i,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),i=t,(n=[{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/Guitar-Mayhem.mp3")}},{key:"buildScene",value:function(){new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),this.scene),this.scene.clearColor=new BABYLON.Color4(0,0,0,0);var e=new a("homeMenuUI");e.addImage(),e.addImgButton("playButton",{onclick:function(){return GAME.goToLevel("RunnerLevel")}})}}])&&O(i.prototype,n),s&&O(i,s),t}(p);function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.options=t,this.keys={},this.paused=!1,this.log=new o,this.canvas=document.getElementById("renderCanvas"),this.engine=new BABYLON.Engine(this.canvas,!0),this.currentLevel=null,this.currentLevelName="HomeMenuLevel",this.levels={HomeMenuLevel:new C,RunnerLevel:new k}}var t,i,n;return t=e,(i=[{key:"start",value:function(){this.listenKeys(),this.lintenTouchEvents(),this.listenOtherEvents(),this.startLevel()}},{key:"pause",value:function(){this.paused=!0}},{key:"isPaused",value:function(){return this.paused}},{key:"resume",value:function(){this.paused=!1}},{key:"listenKeys",value:function(){document.addEventListener("keydown",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=1:83==e.keyCode||40==e.keyCode?this.keys.down=1:65==e.keyCode||37==e.keyCode?this.keys.left=1:68==e.keyCode||39==e.keyCode?this.keys.right=1:80!=e.keyCode&&32!=e.keyCode||(this.keys.shoot=1)}.bind(this)),document.addEventListener("keyup",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=0:83==e.keyCode||40==e.keyCode?this.keys.down=0:65==e.keyCode||37==e.keyCode?this.keys.left=0:68==e.keyCode||39==e.keyCode?this.keys.right=0:80!=e.keyCode&&32!=e.keyCode||(this.keys.shoot=0)}.bind(this)),this.keys.up=!1,this.keys.down=!1,this.keys.left=!1,this.keys.right=!1,this.keys.shoot=!1}},{key:"lintenTouchEvents",value:function(){var e=this,t=new Hammer(document.body);t.get("swipe").set({direction:Hammer.DIRECTION_ALL}),t.on("swipeup",(function(t){e.keys.up=1,setTimeout((function(){e.keys.up=0}),150)})),t.on("swipedown",(function(t){e.keys.down=1,setTimeout((function(){e.keys.down=0}),100)})),t.on("swipeleft",(function(t){e.keys.left=2,setTimeout((function(){e.keys.left=0}),150)})),t.on("swiperight",(function(t){e.keys.right=2,setTimeout((function(){e.keys.right=0}),150)}))}},{key:"listenOtherEvents",value:function(){var e=this;window.addEventListener("blur",(function(){e.pause()})),window.addEventListener("focus",(function(){e.resume()}))}},{key:"goToLevel",value:function(e){this.levels[e]?(this.currentLevel&&this.currentLevel.exit(),this.currentLevelName=e,this.startLevel()):console.error("A level with name "+e+" does not exists")}},{key:"startLevel",value:function(){this.currentLevel=this.levels[this.currentLevelName],this.currentLevel.start()}},{key:"render",value:function(){var e=this;this.startRenderLoop(),window.addEventListener("resize",(function(){e.engine.resize()}))}},{key:"startRenderLoop",value:function(){var e=this;this.engine.runRenderLoop((function(){e.currentLevel.scene.render()}))}},{key:"stopRenderLoop",value:function(){this.engine.stopRenderLoop()}},{key:"isMobile",value:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}}])&&E(t.prototype,i),n&&E(t,n),e}();window.GAME=null;var I=function(){GAME=new G(window.initialGameOptions),GAME.start()};window.addEventListener("load",(function(){I()}))}]);